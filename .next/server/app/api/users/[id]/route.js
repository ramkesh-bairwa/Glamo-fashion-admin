(()=>{var e={};e.id=100,e.ids=[100],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7462:(e,r,s)=>{"use strict";s.d(r,{P:()=>n});let t=s(46101).createPool({host:process.env.MYSQL_HOST||"localhost",user:process.env.MYSQL_USER||"root",password:process.env.MYSQL_PASSWORD||"",database:process.env.MYSQL_DATABASE||"admin_panel",waitForConnections:!0,connectionLimit:10,queueLimit:0});async function n(e,r=[]){let[s]=await t.execute(e,r);return s}console.log(t)},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19771:e=>{"use strict";e.exports=require("process")},27910:e=>{"use strict";e.exports=require("stream")},28303:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=28303,e.exports=r},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},41098:(e,r,s)=>{"use strict";s.d(r,{HU:()=>u,OB:()=>p,VX:()=>d,l4:()=>c,qc:()=>l});var t=s(43205),n=s(44999),a=s(7462);let o=process.env.JWT_SECRET||"your-secret-key",i="admin_token";function u(e,r,s){return(0,t.sign)({userId:e,email:r,role:s},o,{expiresIn:"1d"})}async function c(e){try{let r=function(e){try{return(0,t.verify)(e,o)}catch(e){return null}}(e);if(!r)return null;let s=await (0,a.P)("SELECT id, name, email, role FROM users WHERE id = ?",[r.userId]);return s.length>0?s[0]:null}catch(e){return console.error("Error getting user from token:",e),null}}async function l(e){let r=(0,n.UL)(),s=r.get(i)?.value;if(!s)return!1;let t=await c(s);return t?.role==="admin"}function d(e,r){return e.cookies.set({name:i,value:r,httpOnly:!0,secure:!0,sameSite:"strict",maxAge:86400,path:"/"}),e}function p(e){return e.cookies.set({name:i,value:"",httpOnly:!0,secure:!0,sameSite:"strict",maxAge:0,path:"/"}),e}},41204:e=>{"use strict";e.exports=require("string_decoder")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},66136:e=>{"use strict";e.exports=require("timers")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},87314:(e,r,s)=>{"use strict";s.r(r),s.d(r,{patchFetch:()=>g,routeModule:()=>m,serverHooks:()=>f,workAsyncStorage:()=>E,workUnitAsyncStorage:()=>x});var t={};s.r(t),s.d(t,{DELETE:()=>p,GET:()=>l,PUT:()=>d});var n=s(96559),a=s(48088),o=s(37719),i=s(32190),u=s(7462),c=s(41098);async function l(e,{params:r}){try{if(!await (0,c.qc)(e))return i.NextResponse.json({message:"Unauthorized"},{status:401});let s=r.id,t=await (0,u.P)("SELECT id, name, email, role, created_at FROM users WHERE id = ?",[s]);if(0===t.length)return i.NextResponse.json({message:"User not found"},{status:404});return i.NextResponse.json(t[0])}catch(e){return console.error("Error fetching user:",e),i.NextResponse.json({message:"Internal server error"},{status:500})}}async function d(e,{params:r}){try{if(!await (0,c.qc)(e))return i.NextResponse.json({message:"Unauthorized"},{status:401});let s=r.id,{name:t,email:n,password:a,role:o}=await e.json();if(!t||!n)return i.NextResponse.json({message:"Name and email are required"},{status:400});let l=await (0,u.P)("SELECT id, role FROM users WHERE id = ?",[s]);if(0===l.length)return i.NextResponse.json({message:"User not found"},{status:404});if("admin"===l[0].role&&"admin"!==o&&(await (0,u.P)("SELECT COUNT(*) as count FROM users WHERE role = ?",["admin"]))[0].count<=1)return i.NextResponse.json({message:"Cannot change the role of the last admin user"},{status:400});if((await (0,u.P)("SELECT id FROM users WHERE email = ? AND id != ?",[n,s])).length>0)return i.NextResponse.json({message:"A different user with this email already exists"},{status:400});a?await (0,u.P)("UPDATE users SET name = ?, email = ?, password = ?, role = ? WHERE id = ?",[t,n,a,o,s]):await (0,u.P)("UPDATE users SET name = ?, email = ?, role = ? WHERE id = ?",[t,n,o,s]);let d=await (0,u.P)("SELECT id, name, email, role, created_at FROM users WHERE id = ?",[s]);return i.NextResponse.json({message:"User updated successfully",user:d[0]})}catch(e){return console.error("Error updating user:",e),i.NextResponse.json({message:"Internal server error"},{status:500})}}async function p(e,{params:r}){try{if(!await (0,c.qc)(e))return i.NextResponse.json({message:"Unauthorized"},{status:401});let s=r.id,t=await (0,u.P)("SELECT id, role FROM users WHERE id = ?",[s]);if(0===t.length)return i.NextResponse.json({message:"User not found"},{status:404});if("admin"===t[0].role)return i.NextResponse.json({message:"Cannot delete an admin user"},{status:400});return await (0,u.P)("DELETE FROM users WHERE id = ?",[s]),i.NextResponse.json({message:"User deleted successfully"})}catch(e){return console.error("Error deleting user:",e),i.NextResponse.json({message:"Internal server error"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/users/[id]/route",pathname:"/api/users/[id]",filename:"route",bundlePath:"app/api/users/[id]/route"},resolvedPagePath:"/var/www/html/Glamo-fashion-admin/app/api/users/[id]/route.ts",nextConfigOutput:"standalone",userland:t}),{workAsyncStorage:E,workUnitAsyncStorage:x,serverHooks:f}=m;function g(){return(0,o.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:x})}},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[524,839],()=>s(87314));module.exports=t})();